<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Database Normalization</title>
    <!-- Use relative path for CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <!-- Error handling for CSS loading -->
    <script>
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'LINK' || e.target.tagName === 'SCRIPT') {
                console.error('Failed to load resource:', e.target.src || e.target.href);
                if (e.target.tagName === 'LINK') {
                    // Try to load CSS again with alternate path
                    var href = e.target.href;
                    var fileName = href.substring(href.lastIndexOf('/') + 1);
                    var fallbackLink = document.createElement('link');
                    fallbackLink.rel = 'stylesheet';
                    fallbackLink.href = 'css/' + fileName;
                    document.head.appendChild(fallbackLink);
                }
            }
        }, true);
    </script>
</head>
<body>
    <header>
        <div class="container">
            <h1>Database Normalization</h1>
            <p>An interactive guide to understanding 1NF, 2NF, and 3NF</p>
        </div>
    </header>

    <main class="container">
        <section id="introduction">
            <h2>Introduction to Normalization</h2>
            <p>Normalization is a database design technique that reduces data redundancy and eliminates undesirable characteristics like Insertion, Update, and Deletion Anomalies. Normalization rules divide larger tables into smaller tables and link them using relationships.</p>
        </section>

        <section id="first-normal-form">
            <h2>First Normal Form (1NF)</h2>
            <p>A relation is in 1NF if:</p>
            <ul>
                <li>It contains only atomic (indivisible) values</li>
                <li>There are no repeating groups or arrays</li>
                <li>All entries in a column are of the same domain</li>
            </ul>

            <div class="example-container">
                <h3>Example: Non-1NF Table</h3>
                <p>This table violates 1NF because the Courses column contains multiple values:</p>
                
                <div class="table-editor" id="non-1nf-table">
                    <!-- Table will be inserted by JavaScript -->
                </div>

                <h3>Converting to 1NF</h3>
                <p>To convert to 1NF, we need to make all values atomic:</p>
                
                <div class="table-editor" id="1nf-table">
                    <!-- Table will be inserted by JavaScript -->
                </div>
                
                <button class="reset-btn" data-table="1nf">Reset Table</button>
            </div>
        </section>

        <section id="second-normal-form">
            <h2>Second Normal Form (2NF)</h2>
            <p>A relation is in 2NF if:</p>
            <ul>
                <li>It is in 1NF</li>
                <li>All non-key attributes are fully functionally dependent on the primary key</li>
            </ul>

            <div class="example-container">
                <h3>Example: Non-2NF Table</h3>
                <p>This table violates 2NF because some attributes depend only on part of the composite key:</p>
                
                <div class="table-editor" id="non-2nf-table">
                    <!-- Table will be inserted by JavaScript -->
                </div>

                <h3>Converting to 2NF</h3>
                <p>To convert to 2NF, we create separate tables:</p>
                
                <div class="tables-container">
                    <div>
                        <h4>Orders Table</h4>
                        <div class="table-editor" id="2nf-orders-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                    
                    <div>
                        <h4>OrderDetails Table</h4>
                        <div class="table-editor" id="2nf-order-details-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                    
                    <div>
                        <h4>Products Table</h4>
                        <div class="table-editor" id="2nf-products-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                    
                    <div>
                        <h4>Customers Table</h4>
                        <div class="table-editor" id="2nf-customers-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <button class="reset-btn" data-table="2nf">Reset Tables</button>
            </div>
        </section>

        <section id="third-normal-form">
            <h2>Third Normal Form (3NF)</h2>
            <p>A relation is in 3NF if:</p>
            <ul>
                <li>It is in 2NF</li>
                <li>All non-key attributes are non-transitively dependent on the primary key</li>
            </ul>

            <div class="example-container">
                <h3>Example: Non-3NF Table</h3>
                <p>This table violates 3NF because of transitive dependencies:</p>
                
                <div class="table-editor" id="non-3nf-table">
                    <!-- Table will be inserted by JavaScript -->
                </div>

                <h3>Converting to 3NF</h3>
                <p>To convert to 3NF, we remove transitive dependencies:</p>
                
                <div class="tables-container">
                    <div>
                        <h4>Employees Table</h4>
                        <div class="table-editor" id="3nf-employees-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                    
                    <div>
                        <h4>Departments Table</h4>
                        <div class="table-editor" id="3nf-departments-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <button class="reset-btn" data-table="3nf">Reset Tables</button>
            </div>
        </section>

        <section id="comprehensive-example">
            <h2>Comprehensive Example</h2>
            <p>Let's work through a complete example from unnormalized to 3NF:</p>

            <div class="example-container">
                <h3>Unnormalized Table</h3>
                
                <div class="table-editor" id="unnormalized-table">
                    <!-- Table will be inserted by JavaScript -->
                </div>

                <h3>First Normal Form (1NF)</h3>
                <p>The table is already in 1NF as all values are atomic.</p>

                <h3>Second Normal Form (2NF)</h3>
                
                <div class="tables-container">
                    <div>
                        <h4>Invoices Table</h4>
                        <div class="table-editor" id="comp-2nf-invoices-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                    
                    <div>
                        <h4>InvoiceDetails Table</h4>
                        <div class="table-editor" id="comp-2nf-invoice-details-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                    
                    <div>
                        <h4>Products Table</h4>
                        <div class="table-editor" id="comp-2nf-products-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                </div>

                <h3>Third Normal Form (3NF)</h3>
                
                <div class="tables-container">
                    <div>
                        <h4>Products Table</h4>
                        <div class="table-editor" id="comp-3nf-products-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                    
                    <div>
                        <h4>Categories Table</h4>
                        <div class="table-editor" id="comp-3nf-categories-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                    
                    <div>
                        <h4>Customers Table</h4>
                        <div class="table-editor" id="comp-3nf-customers-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                    
                    <div>
                        <h4>Invoices Table</h4>
                        <div class="table-editor" id="comp-3nf-invoices-table">
                            <!-- Table will be inserted by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <button class="reset-btn" data-table="comp">Reset All Tables</button>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2023 Database Normalization Learning Tool</p>
        </div>
    </footer>

    <!-- Inline the essential table data -->
    <script>
        // Preload the examples.js content directly
        window.tableData = {
            // 1NF Examples
            non1NF: {
                headers: ['StudentID', 'Name', 'Courses'],
                rows: [
                    ['1', 'John', 'Math, Physics, Chemistry'],
                    ['2', 'Sarah', 'Biology, English'],
                    ['3', 'Mike', 'Computer Science, Statistics']
                ]
            },
            
            firstNF: {
                headers: ['StudentID', 'Name', 'Course'],
                rows: [
                    ['1', 'John', 'Math'],
                    ['1', 'John', 'Physics'],
                    ['1', 'John', 'Chemistry'],
                    ['2', 'Sarah', 'Biology'],
                    ['2', 'Sarah', 'English'],
                    ['3', 'Mike', 'Computer Science'],
                    ['3', 'Mike', 'Statistics']
                ]
            },
            
            // 2NF Examples
            non2NF: {
                headers: ['OrderID', 'ProductID', 'ProductName', 'Quantity', 'CustomerID', 'CustomerName'],
                rows: [
                    ['1', 'P1', 'Laptop', '2', 'C1', 'John'],
                    ['1', 'P2', 'Mouse', '1', 'C1', 'John'],
                    ['2', 'P1', 'Laptop', '1', 'C2', 'Sarah'],
                    ['3', 'P3', 'Keyboard', '3', 'C1', 'John']
                ]
            },
            
            secondNFOrders: {
                headers: ['OrderID', 'CustomerID'],
                rows: [
                    ['1', 'C1'],
                    ['2', 'C2'],
                    ['3', 'C1']
                ]
            },
            
            secondNFOrderDetails: {
                headers: ['OrderID', 'ProductID', 'Quantity'],
                rows: [
                    ['1', 'P1', '2'],
                    ['1', 'P2', '1'],
                    ['2', 'P1', '1'],
                    ['3', 'P3', '3']
                ]
            },
            
            secondNFProducts: {
                headers: ['ProductID', 'ProductName'],
                rows: [
                    ['P1', 'Laptop'],
                    ['P2', 'Mouse'],
                    ['P3', 'Keyboard']
                ]
            },
            
            secondNFCustomers: {
                headers: ['CustomerID', 'CustomerName'],
                rows: [
                    ['C1', 'John'],
                    ['C2', 'Sarah']
                ]
            },
            
            // 3NF Examples
            non3NF: {
                headers: ['EmployeeID', 'Department', 'DepartmentHead'],
                rows: [
                    ['E1', 'Sales', 'John Smith'],
                    ['E2', 'Sales', 'John Smith'],
                    ['E3', 'Marketing', 'Sarah Johnson'],
                    ['E4', 'IT', 'Mike Williams'],
                    ['E5', 'IT', 'Mike Williams']
                ]
            },
            
            thirdNFEmployees: {
                headers: ['EmployeeID', 'Department'],
                rows: [
                    ['E1', 'Sales'],
                    ['E2', 'Sales'],
                    ['E3', 'Marketing'],
                    ['E4', 'IT'],
                    ['E5', 'IT']
                ]
            },
            
            thirdNFDepartments: {
                headers: ['Department', 'DepartmentHead'],
                rows: [
                    ['Sales', 'John Smith'],
                    ['Marketing', 'Sarah Johnson'],
                    ['IT', 'Mike Williams']
                ]
            },
            
            // Comprehensive Example
            unnormalized: {
                headers: ['InvoiceID', 'CustomerName', 'CustomerAddress', 'ProductID', 'ProductName', 'Category', 'Price', 'Quantity', 'Total'],
                rows: [
                    ['1001', 'John Doe', '123 Main St, NY', 'P1', 'Laptop', 'Electronics', '1200', '1', '1200'],
                    ['1001', 'John Doe', '123 Main St, NY', 'P2', 'Mouse', 'Accessories', '25', '2', '50'],
                    ['1002', 'Jane Smith', '456 Oak Ave, CA', 'P3', 'Keyboard', 'Accessories', '45', '1', '45'],
                    ['1003', 'Bob Johnson', '789 Pine Rd, TX', 'P1', 'Laptop', 'Electronics', '1200', '1', '1200'],
                    ['1003', 'Bob Johnson', '789 Pine Rd, TX', 'P4', 'Monitor', 'Electronics', '200', '2', '400']
                ]
            },
            
            comp2NFInvoices: {
                headers: ['InvoiceID', 'CustomerName', 'CustomerAddress'],
                rows: [
                    ['1001', 'John Doe', '123 Main St, NY'],
                    ['1002', 'Jane Smith', '456 Oak Ave, CA'],
                    ['1003', 'Bob Johnson', '789 Pine Rd, TX']
                ]
            },
            
            comp2NFInvoiceDetails: {
                headers: ['InvoiceID', 'ProductID', 'Quantity', 'Total'],
                rows: [
                    ['1001', 'P1', '1', '1200'],
                    ['1001', 'P2', '2', '50'],
                    ['1002', 'P3', '1', '45'],
                    ['1003', 'P1', '1', '1200'],
                    ['1003', 'P4', '2', '400']
                ]
            },
            
            comp2NFProducts: {
                headers: ['ProductID', 'ProductName', 'Category', 'Price'],
                rows: [
                    ['P1', 'Laptop', 'Electronics', '1200'],
                    ['P2', 'Mouse', 'Accessories', '25'],
                    ['P3', 'Keyboard', 'Accessories', '45'],
                    ['P4', 'Monitor', 'Electronics', '200']
                ]
            },
            
            comp3NFProducts: {
                headers: ['ProductID', 'ProductName', 'CategoryID', 'Price'],
                rows: [
                    ['P1', 'Laptop', 'C1', '1200'],
                    ['P2', 'Mouse', 'C2', '25'],
                    ['P3', 'Keyboard', 'C2', '45'],
                    ['P4', 'Monitor', 'C1', '200']
                ]
            },
            
            comp3NFCategories: {
                headers: ['CategoryID', 'CategoryName'],
                rows: [
                    ['C1', 'Electronics'],
                    ['C2', 'Accessories']
                ]
            },
            
            comp3NFCustomers: {
                headers: ['CustomerID', 'CustomerName', 'CustomerAddress'],
                rows: [
                    ['C1', 'John Doe', '123 Main St, NY'],
                    ['C2', 'Jane Smith', '456 Oak Ave, CA'],
                    ['C3', 'Bob Johnson', '789 Pine Rd, TX']
                ]
            },
            
            comp3NFInvoices: {
                headers: ['InvoiceID', 'CustomerID'],
                rows: [
                    ['1001', 'C1'],
                    ['1002', 'C2'],
                    ['1003', 'C3']
                ]
            }
        };
        
        // Store original data for reset functionality
        window.originalTableData = JSON.parse(JSON.stringify(window.tableData));
    </script>

    <!-- Inline the TableEditor class directly -->
    <script>
        /**
         * Table Editor - Creates editable tables and manages their state
         */
        class TableEditor {
            constructor(containerId, tableData) {
                this.container = document.getElementById(containerId);
                this.tableData = tableData;
                this.headers = tableData.headers;
                this.rows = JSON.parse(JSON.stringify(tableData.rows)); // Deep copy
                this.render();
            }
            
            render() {
                // Clear container
                this.container.innerHTML = '';
                
                // Create table
                const table = document.createElement('table');
                
                // Create header
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                
                this.headers.forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    headerRow.appendChild(th);
                });
                
                thead.appendChild(headerRow);
                table.appendChild(thead);
                
                // Create body
                const tbody = document.createElement('tbody');
                
                this.rows.forEach((row, rowIndex) => {
                    const tr = document.createElement('tr');
                    
                    row.forEach((cell, cellIndex) => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        td.classList.add('editable');
                        td.dataset.row = rowIndex;
                        td.dataset.col = cellIndex;
                        td.dataset.header = this.headers[cellIndex]; // Store header name for validation
                        td.addEventListener('click', () => this.startEditing(td, cell));
                        tr.appendChild(td);
                    });
                    
                    tbody.appendChild(tr);
                });
                
                table.appendChild(tbody);
                this.container.appendChild(table);
            }
            
            startEditing(cell, value) {
                // Create input element
                const input = document.createElement('input');
                input.value = value;
                input.type = 'text';
                
                // Replace cell content with input
                cell.textContent = '';
                cell.classList.add('editing');
                cell.appendChild(input);
                
                // Focus input
                input.focus();
                
                // Handle input events
                input.addEventListener('blur', () => this.finishEditing(cell, input));
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        this.finishEditing(cell, input);
                    } else if (e.key === 'Escape') {
                        this.cancelEditing(cell, value);
                    }
                });
            }
            
            finishEditing(cell, input) {
                const newValue = input.value.trim();
                const rowIndex = parseInt(cell.dataset.row);
                const colIndex = parseInt(cell.dataset.col);
                const headerName = cell.dataset.header;
                
                // Validate input based on SQL rules
                const validationResult = this.validateSqlInput(newValue, headerName);
                
                if (!validationResult.valid) {
                    // Show error message
                    this.showValidationError(cell, validationResult.message);
                    return;
                }
                
                // Update data
                this.rows[rowIndex][colIndex] = newValue;
                
                // Update cell
                cell.textContent = newValue;
                cell.classList.remove('editing');
                
                // Remove any error messages
                this.removeValidationError(cell);
            }
            
            validateSqlInput(value, headerName) {
                // Check for double quotes in table/column names
                if ((headerName.includes('ID') || 
                    headerName.includes('Name') || 
                    headerName.includes('Table') || 
                    headerName === 'Department' || 
                    headerName === 'Category' || 
                    headerName === 'Course') && 
                    value.includes('"')) {
                    return {
                        valid: false,
                        message: 'SQL identifiers should not use double quotes ("")'
                    };
                }
                
                // Check for SQL reserved words
                const reservedWords = ['SELECT', 'FROM', 'WHERE', 'INSERT', 'UPDATE', 'DELETE', 
                                    'CREATE', 'ALTER', 'DROP', 'TABLE', 'DATABASE', 'INDEX'];
                
                if (reservedWords.includes(value.toUpperCase()) && 
                    (headerName.includes('ID') || headerName.includes('Name'))) {
                    return {
                        valid: false,
                        message: `"${value}" is a SQL reserved word and cannot be used as an identifier`
                    };
                }
                
                // Check for special characters in identifiers
                if ((headerName.includes('ID') || headerName.includes('Name')) && 
                    /[^a-zA-Z0-9_]/.test(value) && value !== '') {
                    return {
                        valid: false,
                        message: 'Identifiers should only contain letters, numbers, and underscores'
                    };
                }
                
                return { valid: true };
            }
            
            showValidationError(cell, message) {
                // Remove any existing error message
                this.removeValidationError(cell);
                
                // Create error message element
                const errorElement = document.createElement('div');
                errorElement.classList.add('validation-error');
                errorElement.textContent = message;
                
                // Insert after the cell
                cell.parentNode.insertBefore(errorElement, cell.nextSibling);
                
                // Highlight the cell
                cell.classList.add('error');
                
                // Keep the cell in editing mode
                const input = cell.querySelector('input');
                if (input) {
                    input.focus();
                }
            }
            
            removeValidationError(cell) {
                // Remove error class from cell
                cell.classList.remove('error');
                
                // Find and remove error message
                const row = cell.parentNode;
                const errorElement = row.querySelector('.validation-error');
                if (errorElement) {
                    row.removeChild(errorElement);
                }
            }
            
            cancelEditing(cell, originalValue) {
                cell.textContent = originalValue;
                cell.classList.remove('editing');
                this.removeValidationError(cell);
            }
            
            reset() {
                // Get the original data for this table
                const originalId = this.container.id.replace('-table', '');
                const originalData = window.originalTableData[originalId];
                
                // Reset data
                this.rows = JSON.parse(JSON.stringify(originalData.rows));
                
                // Re-render
                this.render();
            }
        }
    </script>

    <!-- Initialize tables -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing tables...');
            try {
                // Create 1NF tables
                const non1NFTable = new TableEditor('non-1nf-table', window.tableData.non1NF);
                const firstNFTable = new TableEditor('1nf-table', window.tableData.firstNF);
                
                // Create 2NF tables
                const non2NFTable = new TableEditor('non-2nf-table', window.tableData.non2NF);
                const secondNFOrdersTable = new TableEditor('2nf-orders-table', window.tableData.secondNFOrders);
                const secondNFOrderDetailsTable = new TableEditor('2nf-order-details-table', window.tableData.secondNFOrderDetails);
                const secondNFProductsTable = new TableEditor('2nf-products-table', window.tableData.secondNFProducts);
                const secondNFCustomersTable = new TableEditor('2nf-customers-table', window.tableData.secondNFCustomers);
                
                // Create 3NF tables
                const non3NFTable = new TableEditor('non-3nf-table', window.tableData.non3NF);
                const thirdNFEmployeesTable = new TableEditor('3nf-employees-table', window.tableData.thirdNFEmployees);
                const thirdNFDepartmentsTable = new TableEditor('3nf-departments-table', window.tableData.thirdNFDepartments);
                
                // Create comprehensive example tables
                const unnormalizedTable = new TableEditor('unnormalized-table', window.tableData.unnormalized);
                const comp2NFInvoicesTable = new TableEditor('comp-2nf-invoices-table', window.tableData.comp2NFInvoices);
                const comp2NFInvoiceDetailsTable = new TableEditor('comp-2nf-invoice-details-table', window.tableData.comp2NFInvoiceDetails);
                const comp2NFProductsTable = new TableEditor('comp-2nf-products-table', window.tableData.comp2NFProducts);
                const comp3NFProductsTable = new TableEditor('comp-3nf-products-table', window.tableData.comp3NFProducts);
                const comp3NFCategoriesTable = new TableEditor('comp-3nf-categories-table', window.tableData.comp3NFCategories);
                const comp3NFCustomersTable = new TableEditor('comp-3nf-customers-table', window.tableData.comp3NFCustomers);
                const comp3NFInvoicesTable = new TableEditor('comp-3nf-invoices-table', window.tableData.comp3NFInvoices);
                
                // Store all tables in a map for easy access
                const tables = {
                    '1nf': [firstNFTable],
                    '2nf': [secondNFOrdersTable, secondNFOrderDetailsTable, secondNFProductsTable, secondNFCustomersTable],
                    '3nf': [thirdNFEmployeesTable, thirdNFDepartmentsTable],
                    'comp': [
                        comp2NFInvoicesTable, comp2NFInvoiceDetailsTable, comp2NFProductsTable,
                        comp3NFProductsTable, comp3NFCategoriesTable, comp3NFCustomersTable, comp3NFInvoicesTable
                    ]
                };
                
                // Add event listeners to reset buttons
                document.querySelectorAll('.reset-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const tableGroup = button.dataset.table;
                        tables[tableGroup].forEach(table => table.reset());
                    });
                });

                // Add SQL help buttons to each example container
                document.querySelectorAll('.example-container').forEach(container => {
                    const helpBtn = document.createElement('div');
                    helpBtn.classList.add('sql-help-btn');
                    helpBtn.textContent = '?';
                    helpBtn.title = 'SQL Rules Help';
                    
                    helpBtn.addEventListener('click', () => {
                        // Create tooltip
                        const tooltip = document.createElement('div');
                        tooltip.classList.add('sql-help-tooltip');
                        tooltip.innerHTML = `
                            <h4>SQL Naming Rules:</h4>
                            <ul>
                                <li>No double quotes in identifiers</li>
                                <li>No SQL reserved words (SELECT, FROM, etc.)</li>
                                <li>Use only letters, numbers, and underscores</li>
                                <li>Names should be descriptive and meaningful</li>
                                <li>Primary keys should be properly defined</li>
                                <li>Foreign keys should reference primary keys</li>
                            </ul>
                        `;
                        
                        // Add close button
                        const closeBtn = document.createElement('button');
                        closeBtn.textContent = 'Close';
                        closeBtn.addEventListener('click', () => {
                            container.removeChild(tooltip);
                        });
                        tooltip.appendChild(closeBtn);
                        
                        // Add to container
                        container.appendChild(tooltip);
                        
                        // Auto-close after 10 seconds
                        setTimeout(() => {
                            if (container.contains(tooltip)) {
                                container.removeChild(tooltip);
                            }
                        }, 10000);
                    });
                    
                    container.style.position = 'relative';
                    container.appendChild(helpBtn);
                });
                
                console.log('All tables initialized successfully!');
            } catch (error) {
                console.error('Error initializing tables:', error);
                document.querySelectorAll('.table-editor').forEach(div => {
                    div.classList.add('error');
                    div.textContent = 'Error initializing tables: ' + error.message;
                });
            }
        });
    </script>
</body>
</html> 